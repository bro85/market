(self.webpackChunkbuildmarket_angular=self.webpackChunkbuildmarket_angular||[]).push([[777,949],{9777:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DashboardModule:()=>q});var s=r(1116),a=r(1334),i=r(1462),o=r(5366),n=r(5763),c=r(5031),l=r(8207),u=r(6455),p=r(3070),d=r(9550),g=r(7672),h=r(9704),b=r(1663);const _=function(e,t){return["/catalog",e,t]},m=function(e,t){return["/admin","product",e,t,"edit"]};function f(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"tr"),o.TgZ(1,"td",12),o._uU(2),o.qZA(),o.TgZ(3,"td",13),o.TgZ(4,"a",14),o.TgZ(5,"span"),o._uU(6),o.qZA(),o.qZA(),o.qZA(),o.TgZ(7,"td",15),o._uU(8),o.qZA(),o.TgZ(9,"td",16),o._uU(10),o.ALo(11,"removeComma"),o.ALo(12,"number"),o.qZA(),o.TgZ(13,"td",17),o._uU(14),o.ALo(15,"date"),o.qZA(),o.TgZ(16,"td",18),o.TgZ(17,"a",19),o._uU(18,"\u0412\u0456\u0434\u043a\u0440\u0438\u0442\u0438"),o.qZA(),o.qZA(),o.TgZ(19,"td",20),o.TgZ(20,"button",21),o.NdJ("click",function(){const t=o.CHM(e).$implicit;return o.oxw(2).remove(t)}),o._uU(21,"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438"),o.qZA(),o.qZA(),o.qZA()}if(2&e){const e=t.$implicit,r=t.index,s=o.oxw(2);o.xp6(2),o.Oqu(r+1),o.xp6(2),o.Q6J("routerLink",o.WLB(15,_,e.type,e.id)),o.xp6(2),o.Oqu(e.title),o.xp6(2),o.Oqu(s.typesNames[e.type]),o.xp6(2),o.Oqu(o.lcZ(11,7,o.xi3(12,9,e.price,"1.2-2"))),o.xp6(4),o.Oqu(o.xi3(15,12,e.date,"dd.MM.yyyy, HH:mm:ss")),o.xp6(3),o.Q6J("routerLink",o.WLB(18,m,e.type,e.id))}}function y(e,t){if(1&e&&(o.TgZ(0,"table",8),o.TgZ(1,"thead",9),o.TgZ(2,"tr"),o.TgZ(3,"th"),o._uU(4,"\u2116"),o.qZA(),o.TgZ(5,"th"),o._uU(6,"\u041d\u0430\u0437\u0432\u0430"),o.qZA(),o.TgZ(7,"th"),o._uU(8,"\u0422\u0438\u043f"),o.qZA(),o.TgZ(9,"th"),o._uU(10,"\u0412\u0430\u0440\u0442\u0456\u0441\u0442\u044c, \u20b4"),o.qZA(),o.TgZ(11,"th"),o._uU(12,"\u0414\u0430\u0442\u0430 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f"),o.qZA(),o.TgZ(13,"th"),o._uU(14,"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043d\u043d\u044f"),o.qZA(),o.TgZ(15,"th"),o._uU(16,"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(17,"tbody",10),o.YNc(18,f,22,21,"tr",11),o.ALo(19,"search"),o.qZA(),o.qZA()),2&e){const e=o.oxw();o.xp6(18),o.Q6J("ngForOf",o.xi3(19,1,e.products,e.searchForm.get("filterTitle").value))}}function Z(e,t){1&e&&o._UZ(0,"mat-spinner",22)}const T=[{path:"",component:(()=>{class e{constructor(e,t,r,s){this._fileUploadService=e,this._productService=t,this._productTypeService=r,this._storeService=s,this.products=[],this.typesNames={}}ngOnDestroy(){var e;null===(e=this._productServiceSubscription)||void 0===e||e.unsubscribe()}ngOnInit(){this.searchForm=new i.cw({filterTitle:new i.NI("")}),this._productServiceSubscription=this._productService.getAll().subscribe(e=>{this._productTypeService.getTypes().subscribe(t=>{t.forEach(e=>{e.id&&(this.typesNames[e.id]=e.title)}),this.products=e})})}remove(e){this._storeService.showPreloader.next(!0),this._productService.remove(e).then(()=>{this.products=this.products.filter(t=>t.id!==e.id)},e=>{console.error("remove1 error: ",e)}).then(()=>{this._fileUploadService.deleteProductInStorage(e.type,e.id),this._storeService.showPreloader.next(!1)},e=>{console.error("remove2 error: ",e)})}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(n.J),o.Y36(c.M),o.Y36(l.c),o.Y36(u.d))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-dashboard"]],decls:12,vars:3,consts:[[1,"site__centered","site__pb"],[1,"site__title"],[1,"form-control"],[3,"formGroup"],["appearance","outline"],["type","text","formControlName","filterTitle","matInput",""],["class","nice-table",4,"ngIf","ngIfElse"],["loading",""],[1,"nice-table"],[1,"nice-table__thead"],[1,"nice-table__tbody"],[4,"ngFor","ngForOf"],["data-label","\u2116"],["data-label","\u041d\u0430\u0437\u0432\u0430",1,"nice-table__title"],["target","_blank",1,"nice-table__product-title",3,"routerLink"],["data-label","\u0422\u0438\u043f"],["data-label","\u0412\u0430\u0440\u0442\u0456\u0441\u0442\u044c, \u20b4",1,"nice-table__price"],["data-label","\u0414\u0430\u0442\u0430 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f",1,"nice-table__date"],["data-label","\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043d\u043d\u044f"],["target","_blank",1,"btn","btn_small",3,"routerLink"],["data-label","\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438"],[1,"btn","btn_4","btn_small",3,"click"],[1,"loading-type-1"]],template:function(e,t){if(1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"h1",1),o._uU(2,"\u041f\u0430\u043d\u0435\u043b\u044c \u0442\u043e\u0432\u0430\u0440\u0456\u0432"),o.qZA(),o.TgZ(3,"div",2),o.TgZ(4,"form",3),o.TgZ(5,"mat-form-field",4),o.TgZ(6,"mat-label"),o._uU(7,"\u0424\u0456\u043b\u044c\u0442\u0440 \u043f\u043e \u043d\u0430\u0437\u0432\u0456 \u0442\u043e\u0432\u0430\u0440\u0443"),o.qZA(),o._UZ(8,"input",5),o.qZA(),o.qZA(),o.qZA(),o.YNc(9,y,20,4,"table",6),o.YNc(10,Z,1,0,"ng-template",null,7,o.W1O),o.qZA()),2&e){const e=o.MAs(11);o.xp6(4),o.Q6J("formGroup",t.searchForm),o.xp6(5),o.Q6J("ngIf",t.products.length)("ngIfElse",e)}},directives:[i._Y,i.JL,i.sg,p.KE,p.hX,i.Fj,d.Nt,i.JJ,i.u,s.O5,s.sg,a.yS,g.$g],pipes:[h.C,b.f,s.JJ,s.uU],styles:[""]}),e})()}];let A=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[a.Bz.forChild(T)],a.Bz]}),e})();var v=r(866),I=r(4599);let q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[s.ez,A,p.lN,d.c,g.Cq,i.UX,v.Z,I.t]]}),e})()},866:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var s=r(1116),a=r(5366);let i=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[s.ez]]}),e})()},1663:(e,t,r)=>{"use strict";r.d(t,{f:()=>a});var s=r(5366);let a=(()=>{class e{transform(e){return null!=e?e.replace(/,/g," "):""}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=s.Yjl({name:"removeComma",type:e,pure:!0}),e})()},5763:(e,t,r)=>{"use strict";r.d(t,{J:()=>c});var s=r(1520),a=r(5366),i=r(5540),o=r(6145),n=r(6455);let c=(()=>{class e{constructor(e,t,r){this._db=e,this._storage=t,this._storeService=r,this.basePathDB="/images/products",this.basePathProductType="/images/productType",this.basePathStorage="/images/products",this._imagesArray=[],this._typeImagesArray=[]}deleteFile(e){this.deleteFileDatabase(e.key).then(()=>{this.deleteFileStorage(e.name)}).catch(e=>console.error("deleteFile: ",e))}deleteImage(e,t,r,s){this.deleteImageInStorage(e,t,s),this.deleteImageInDatabase(e,t,r).then(()=>{}).catch(e=>console.error("database error: ",e))}deleteProductInStorage(e,t){return this._storage.ref(`${this.basePathStorage}/${e}/${t}`).listAll().subscribe(r=>{r.items.forEach(r=>{this.deleteImageInStorage(e,t,r.name)})})}deleteTypeImageInStorage(e,t){this._storage.ref(`${this.basePathProductType}/${e}`).child(t).delete()}getFiles(e){return this._db.list("/products/typeID/productID",t=>t.limitToLast(e))}pushImageToStorage(e,t,r,a,i=[]){const o=`${this.basePathDB}/${r}/${a}/${e.file.name}`,n=this._storage.ref(o),c=this._storage.upload(o,e.file);return this._imagesArray.push(...i),c.snapshotChanges().pipe((0,s.x)(()=>{n.getDownloadURL().subscribe(r=>{this._imagesArray.push({index:t,name:e.file.name,original:r,size:e.file.size}),this._storeService.imagesArray.next(this._imagesArray)})})).subscribe(),c.percentageChanges()}pushImageTypeToStorage(e,t,r){const a=`${this.basePathProductType}/${r}/${e.file.name}`,i=this._storage.ref(a),o=this._storage.upload(a,e.file);return this._typeImagesArray=[],o.snapshotChanges().pipe((0,s.x)(()=>{i.getDownloadURL().subscribe(t=>{this._typeImagesArray.push({name:e.file.name,original:t,size:e.file.size}),this._storeService.typeImagesArray.next(this._typeImagesArray)})})).subscribe(),o.percentageChanges()}deleteFileDatabase(e){return this._db.list(this.basePathDB).remove(e)}deleteFileStorage(e){this._storage.ref(this.basePathDB).child(e).delete()}deleteImageInDatabase(e,t,r){return this._db.list(`products/${e}/${t}/images`).remove(r)}deleteImageInStorage(e,t,r){this._storage.ref(`${this.basePathStorage}/${e}/${t}`).child(r).delete()}}return e.\u0275fac=function(t){return new(t||e)(a.LFG(i.KQ),a.LFG(o.Q1),a.LFG(n.d))},e.\u0275prov=a.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},8207:(e,t,r)=>{"use strict";r.d(t,{c:()=>c});var s=r(529),a=r(9996),i=r(5366),o=r(2693),n=r(5540);let c=(()=>{class e{constructor(e,t){this._http=e,this._angularFireDatabase=t}create(e){return this._angularFireDatabase.list("/productType").push(e)}getTypes(){return this._http.get(`${s.N.firebaseConfig.databaseURL}/productType.json`).pipe((0,a.U)(e=>this._getTypesEdit(e),e=>{console.log("error ",e)}))}getType(e){return this._http.get(`${s.N.firebaseConfig.databaseURL}/productType/${e}.json`).pipe((0,a.U)(e=>e,e=>{console.log("error ",e)}))}remove(e){const t=this._angularFireDatabase.object(`/productType/${e}`);return console.log("curItem ",t),this._angularFireDatabase.object(`/productType/${e}`).remove()}update(e){return this._angularFireDatabase.list("/productType").set(e.id,e)}_getTypesEdit(e){return e?Object.keys(e).map(t=>Object.assign(Object.assign({},e[t]),{id:t,date:new Date(e[t].date)}),e=>{}):[]}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(o.eN),i.LFG(n.KQ))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},5031:(e,t,r)=>{"use strict";r.d(t,{M:()=>c});var s=r(529),a=r(9996),i=r(5366),o=r(2693),n=r(5540);let c=(()=>{class e{constructor(e,t){this._http=e,this._angularFireDatabase=t}create(e){return this._angularFireDatabase.list(`/products/${e.type}`).push(e)}getAll(){return this._http.get(`${s.N.firebaseConfig.databaseURL}/products.json`).pipe((0,a.U)(e=>{let t={};const r=Object.values(e);for(let s=0;s<r.length;s++)t=Object.assign(t,r[s]);return Object.keys(t).map(e=>Object.assign(Object.assign({},t[e]),{id:e}))}))}getByTypeAndID(e,t){return this._http.get(`${s.N.firebaseConfig.databaseURL}/products/${e}/${t}.json`).pipe((0,a.U)(e=>null===e?{}:Object.assign(Object.assign({},e),{id:t})))}getProductsByType(e){return this._http.get(`${s.N.firebaseConfig.databaseURL}/products/${e}.json`).pipe((0,a.U)(e=>e?Object.keys(e).map(t=>Object.assign(Object.assign({},e[t]),{id:t})):[]))}remove(e){return this._angularFireDatabase.object(`/products/${e.type}/${e.id}`).remove()}update(e){return this._angularFireDatabase.list(`/products/${e.type}`).set(e.id,e)}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(o.eN),i.LFG(n.KQ))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);