(self.webpackChunkbuildmarket_angular=self.webpackChunkbuildmarket_angular||[]).push([[246],{2193:(e,t,i)=>{"use strict";i.d(t,{z:()=>l});var s=i(2935),n=i(5366),r=i(1116),o=i(4369);function a(e,t){if(1&e&&n._UZ(0,"h1",4),2&e){const e=n.oxw();n.Q6J("innerHTML",e.title,n.oJD)}}function c(e,t){if(1&e&&n._UZ(0,"div",5),2&e){const e=n.oxw();n.Q6J("innerHTML",e.text,n.oJD)}}let l=(()=>{class e{constructor(e,t){this.data=e,this.dialogRef=t,this.cancelTxt="\u041d\u0456",this.confirmTxt="\u0422\u0430\u043a",this.cancelClass="btn_2",this.confirmClass=""}ngOnInit(){this.data&&(this.data.title&&(this.title=this.data.title),this.data.text&&(this.text=this.data.text),this.data.cancelTxt&&(this.cancelTxt=this.data.cancelTxt),this.data.confirmTxt&&(this.confirmTxt=this.data.confirmTxt),this.data.cancelClass&&(this.cancelClass=this.data.cancelClass),this.data.confirmClass&&(this.confirmClass=this.data.confirmClass))}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(s.WI),n.Y36(s.so))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-popup-confirm"]],decls:7,vars:8,consts:[["mat-dialog-title","",3,"innerHTML",4,"ngIf"],["mat-dialog-content","",3,"innerHTML",4,"ngIf"],["mat-dialog-actions",""],["mat-button","",1,"btn",3,"mat-dialog-close","ngClass"],["mat-dialog-title","",3,"innerHTML"],["mat-dialog-content","",3,"innerHTML"]],template:function(e,t){1&e&&(n.YNc(0,a,1,1,"h1",0),n.YNc(1,c,1,1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"button",3),n._uU(4),n.qZA(),n.TgZ(5,"button",3),n._uU(6),n.qZA(),n.qZA()),2&e&&(n.Q6J("ngIf",t.title),n.xp6(1),n.Q6J("ngIf",t.text),n.xp6(2),n.Q6J("mat-dialog-close",!1)("ngClass",t.cancelClass),n.xp6(1),n.Oqu(t.cancelTxt),n.xp6(1),n.Q6J("mat-dialog-close",!0)("ngClass",t.confirmClass),n.xp6(1),n.Oqu(t.confirmTxt))},directives:[r.O5,s.H8,o.lW,s.ZT,r.mk,s.uh,s.xY],styles:[".mat-dialog-actions[_ngcontent-%COMP%]{padding-top:23px}.mat-dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0 15px 15px 0}.mat-dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}"]}),e})()},8246:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EditTypeModule:()=>k});var s=i(1116),n=i(1334),r=i(1462),o=i(2925),a=i(6446),c=i(7777),l=i(2193),u=i(5366),p=i(2935),d=i(5763),g=i(8207),m=i(5031),h=i(6455),f=i(3070),_=i(9550),b=i(4369),v=i(6761);function y(e,t){1&e&&(u.TgZ(0,"div",23),u._uU(1,"\u0412\u0432\u0435\u0434\u0456\u0442\u044c \u043d\u0430\u0437\u0432\u0443 \u0442\u0438\u043f\u0443"),u.qZA())}function T(e,t){1&e&&(u.TgZ(0,"div",23),u._uU(1,"\u0422\u0430\u043a\u0430 \u043d\u0430\u0437\u0432\u0430 \u0432\u0436\u0435 \u0456\u0441\u043d\u0443\u0454"),u.qZA())}function Z(e,t){if(1&e&&(u.TgZ(0,"div"),u.YNc(1,y,2,0,"div",22),u.YNc(2,T,2,0,"div",22),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.Q6J("ngIf",e.form.get("title").errors.required),u.xp6(1),u.Q6J("ngIf",e.form.get("title").errors.busyTitle)}}function x(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",5),u.TgZ(1,"app-selected-files",24),u.NdJ("removeFile",function(){return u.CHM(e),u.oxw(2).removeSelectedFile()}),u.qZA(),u.qZA()}if(2&e){const e=u.oxw(2);u.xp6(1),u.Q6J("isTypePreview",!0)("selectedFiles",e.selectedFiles)}}function A(e,t){if(1&e&&(u.TgZ(0,"span"),u._uU(1),u.qZA()),2&e){const e=u.oxw().$implicit;u.xp6(1),u.hij("(",e.unit,")")}}function I(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"li",27),u._uU(1),u.YNc(2,A,2,1,"span",8),u.TgZ(3,"span",28),u.NdJ("click",function(){const t=u.CHM(e).index;return u.oxw(3).removeParameter(t)}),u.qZA(),u.qZA()}if(2&e){const e=t.$implicit;u.xp6(1),u.hij(" ",e.title," "),u.xp6(1),u.Q6J("ngIf",e.unit)}}function S(e,t){if(1&e&&(u.TgZ(0,"ul",25),u.YNc(1,I,4,2,"li",26),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",e.type.parameters)}}function w(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"form",3),u.NdJ("ngSubmit",function(){return u.CHM(e),u.oxw().submit()}),u.TgZ(1,"h1",4),u._uU(2,"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043d\u043d\u044f \u0442\u0438\u043f\u0443"),u.qZA(),u.TgZ(3,"div",5),u.TgZ(4,"mat-form-field",6),u.TgZ(5,"mat-label"),u._uU(6,"\u041d\u0430\u0437\u0432\u0430 \u0442\u0438\u043f\u0443"),u.qZA(),u.TgZ(7,"input",7),u.NdJ("focusout",function(t){return u.CHM(e),u.oxw().titleFocusOut(t)}),u.qZA(),u.qZA(),u.YNc(8,Z,3,2,"div",8),u.qZA(),u.TgZ(9,"div",9),u.TgZ(10,"div"),u.TgZ(11,"button",10),u.NdJ("click",function(){return u.CHM(e),u.MAs(14).click()}),u._uU(12,"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0442\u0435 \u0444\u043e\u0442\u043e \u0442\u0438\u043f\u0443"),u.qZA(),u.TgZ(13,"input",11,12),u.NdJ("change",function(t){return u.CHM(e),u.oxw().onFileSelected(t)}),u.qZA(),u.TgZ(15,"mat-form-field",13),u._UZ(16,"input",14),u.qZA(),u.qZA(),u.TgZ(17,"div",15),u._uU(18," \u0414\u043b\u044f \u043a\u0440\u0430\u0449\u043e\u0433\u043e \u0432\u0456\u0434\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f \u043f\u043e\u0432\u0438\u043d\u043d\u0435 \u043c\u0430\u0442\u0438 \u0440\u043e\u0437\u043c\u0456\u0440\u0438 600 \u043f\u0456\u043a\u0441\u0435\u043b\u0456\u0432 \u043f\u043e \u0433\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u0456 \u0442\u0430 400 \u043f\u0456\u043a\u0441\u0435\u043b\u0456\u0432 \u043f\u043e \u0432\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u0456. "),u.qZA(),u.qZA(),u.YNc(19,x,2,2,"div",16),u.TgZ(20,"div",5),u.TgZ(21,"h2",17),u._uU(22,"\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438 \u0442\u043e\u0432\u0430\u0440\u0443"),u.qZA(),u.TgZ(23,"p"),u._uU(24,"\u0414\u043b\u044f \u043a\u043e\u0436\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0443 \u0442\u043e\u0432\u0430\u0440\u0456\u0432 \u0431\u0443\u0434\u0443\u0442\u044c \u0441\u0432\u043e\u0457 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438 (\u0432\u0430\u0433\u0430, \u043c\u0430\u0440\u043a\u0430, \u0431\u0440\u0435\u043d\u0434 \u0442\u043e\u0449\u043e), \u043a\u043e\u0442\u0440\u0456 \u0431\u0443\u0434\u0443\u0442\u044c \u0437\u0430\u043f\u043e\u0432\u043d\u044e\u0432\u0430\u0442\u0438\u0441\u044c \u043f\u0440\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u0456 \u0442\u043e\u0432\u0430\u0440\u0443. \u0417\u0430 \u0446\u0438\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 \u043c\u043e\u0436\u043d\u0430 \u0431\u0443\u0434\u0435 \u0432\u0456\u0434\u0444\u0456\u043b\u044c\u0442\u0440\u0443\u0432\u0430\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u043e\u0432\u0430\u0440\u0456\u0432 \u0443 \u043a\u0430\u0442\u0430\u043b\u043e\u0437\u0456."),u.qZA(),u.YNc(25,S,2,1,"ul",18),u.TgZ(26,"p"),u.TgZ(27,"button",19),u.NdJ("click",function(){return u.CHM(e),u.oxw().showNewParamPopup()}),u.TgZ(28,"span"),u._uU(29,"\u0414\u043e\u0434\u0430\u0442\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(30,"div",5),u.TgZ(31,"button",20),u._uU(32,"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0442\u0438\u043f"),u.qZA(),u.qZA(),u.TgZ(33,"div",5),u.TgZ(34,"p"),u.TgZ(35,"button",21),u.NdJ("click",function(){return u.CHM(e),u.oxw().deleteType()}),u.TgZ(36,"span"),u._uU(37,"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438 \u0442\u0438\u043f"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("formGroup",e.form),u.xp6(8),u.Q6J("ngIf",e.form.get("title").touched&&e.form.get("title").invalid),u.xp6(11),u.Q6J("ngIf",e.selectedFiles.length>0),u.xp6(6),u.Q6J("ngIf",!!e.type&&e.type.parameters.length>0),u.xp6(6),u.Q6J("disabled",e.form.invalid||e.submitted)}}const q=function(){return["/admin","types"]};function F(e,t){1&e&&(u.TgZ(0,"h1",4),u._uU(1,"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043d\u043d\u044f \u0442\u0438\u043f\u0443"),u.qZA(),u.TgZ(2,"p"),u._uU(3,"\u0426\u0435\u0439 \u0442\u0438\u043f \u0442\u043e\u0432\u0430\u0440\u0456\u0432 \u0432\u0456\u0434\u0441\u0443\u0442\u043d\u0456\u0439. \u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043e "),u.TgZ(4,"a",29),u.TgZ(5,"span"),u._uU(6,"\u0441\u043f\u0438\u0441\u043a\u0443 \u0442\u0438\u043f\u0456\u0432"),u.qZA(),u.qZA(),u._uU(7,"."),u.qZA()),2&e&&(u.xp6(4),u.Q6J("routerLink",u.DdM(1,q)))}const C=[{path:"",component:(()=>{class e{constructor(e,t,i,s,n,r,o){this._activatedRoute=e,this._dialog=t,this._fileUploadService=i,this._productTypeService=s,this._productService=n,this._router=r,this._storeService=o,this.isType=!0,this.percentage=0,this.selectedFiles=[],this.submitted=!1}deleteType(){const e=this._productService.getProductsByType(this._typeId).subscribe(t=>{if(t.length>0)return this.openNoticeDialog(),void e.unsubscribe();this._storeService.showPreloader.next(!0),this.deletingTypeConfirm(),e.unsubscribe()})}deletingTypeConfirm(){const e=this._dialog.open(l.z,{width:"400px",data:{title:"\u0412\u0438\u0434\u0430\u043b\u0435\u043d\u043d\u044f \u0442\u0438\u0440\u0443 \u0442\u043e\u0432\u0430\u0440\u0456\u0432.",text:"<p>\u0412\u0438 \u0432\u043f\u0435\u0432\u043d\u0435\u043d\u0456, \u0449\u043e \u0431\u0430\u0436\u0430\u0454\u0442\u0435 \u0432\u0438\u0434\u0430\u043b\u0438\u0442\u0438 \u0434\u0430\u043d\u0438\u0439 \u0442\u0438\u043f \u0442\u043e\u0432\u0430\u0440\u0456\u0432?</p>",cancelTxt:"\u041d\u0435 \u0432\u0438\u0434\u0430\u043b\u044f\u0442\u0438",confirmTxt:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438",cancelClass:"",confirmClass:"btn_4"}}).afterClosed().subscribe(t=>{if(t)return this.removeDataType(),void e.unsubscribe();this._storeService.showPreloader.next(!1),e.unsubscribe()})}getImageFromServer(){var e,t,i;this.selectedFiles=[{image:null===(e=this.type.image)||void 0===e?void 0:e.original,isOnStorage:!0,name:null===(t=this.type.image)||void 0===t?void 0:t.name,size:null===(i=this.type.image)||void 0===i?void 0:i.size}]}getType(){const e=this._productTypeService.getType(this._typeId).subscribe(t=>{t?(t.history||(t.history=[]),t.id||(t.id=this._typeId),t.parameters||(t.parameters=[]),t.title||(t.title=""),this.type=Object.assign({},t),this.getImageFromServer(),this.initForm(),e.unsubscribe()):this.isType=!1})}initForm(){var e,t,i;this.form=new r.cw({fileName:new r.NI((null===(t=null===(e=this.type)||void 0===e?void 0:e.image)||void 0===t?void 0:t.name)||"",r.kI.required),title:new r.NI((null===(i=this.type)||void 0===i?void 0:i.title)||null,r.kI.required)})}isTypeTitleOnServer(e,t){return!!t.find(t=>this._typeId!==t.id&&t.title.trim().toLowerCase()===e.trim().toLowerCase())}onFileSelected(e){let t=e.target.files;this.selectFile(t),this.form.controls.fileName.setValue(t[0]?t[0].name:"")}ngOnDestroy(){var e,t,i;null===(e=this._activatedRouteSubscription)||void 0===e||e.unsubscribe(),null===(t=this._fileUploadSubscription)||void 0===t||t.unsubscribe(),null===(i=this._imagesSubscription)||void 0===i||i.unsubscribe()}ngOnInit(){this._activatedRouteSubscription=this._activatedRoute.params.subscribe(e=>{this._typeId=e.typeID,this.getType(),this.initForm()}),this._storeService.typeImagesArray.next([])}openNoticeDialog(){this._dialog.open(c.N,{data:{title:"\u0426\u0435\u0439 \u0442\u0438\u043f \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440\u0438.",message:"<p>\u0414\u043e\u0437\u0432\u043e\u043b\u0435\u043d\u043e \u0432\u0438\u0434\u0430\u043b\u044f\u0442\u0438 \u043b\u0438\u0448\u0435 \u043f\u043e\u0440\u043e\u0436\u043d\u0456 \u0442\u0438\u043f\u0438 \u0442\u043e\u0432\u0430\u0440\u0456\u0432.</p>",buttonText:"\u0417\u0430\u043a\u0440\u0438\u0442\u0438"}})}removeDataType(){this.selectedFiles[0].name&&this._fileUploadService.deleteTypeImageInStorage(this._typeId,this.selectedFiles[0].name),this._productTypeService.remove(this._typeId).then(()=>{this._storeService.showPreloader.next(!1),this._router.navigate(["/admin","types"])})}removeParameter(e){this.type.parameters.splice(e,1)}removeSelectedFile(){this.selectedFiles=[],this.form.controls.fileName.setValue("")}selectFile(e){Array.from(e).forEach(e=>{let t,i=new FileReader;i.onloadend=()=>{t=i.result,this.selectedFiles=[{file:e,image:t,isOnStorage:!1,name:e.name,size:e.size}]},i.readAsDataURL(e)})}showNewParamPopup(){const e=this._dialog.open(a.q,{width:"400px",data:{paramsArray:this.type.parameters}}).afterClosed().subscribe(t=>{t&&this.type.parameters.push(t),e.unsubscribe()})}submit(){if(this.form.invalid)return;this._storeService.showPreloader.next(!0);let e="";if(localStorage.getItem("user")){const t=JSON.parse(localStorage.getItem("user"));t.email&&(e=t.email)}this.type.history.push({email:e,date:(new Date).toString()}),this.type.title=this.form.get("title").value,this.selectedFiles[0].isOnStorage?this.updateType():this.uploadImage()}titleFocusOut(e){const t=this._productTypeService.getTypes().subscribe(i=>{this.isTypeTitleOnServer(e.target.value,i)&&this.form.controls.title.setErrors({busyTitle:!0}),t.unsubscribe()})}updateType(){this._productTypeService.update(this.type).then(()=>{var e;null===(e=this._imagesSubscription)||void 0===e||e.unsubscribe(),this.form.reset(),this.submitted=!1,this._storeService.showPreloader.next(!1),this._storeService.typeImagesArray.next([]),this._router.navigate(["/admin","types"])},e=>{})}uploadImage(){const e=new o.p(this.selectedFiles[0].file);this._imagesSubscription=this._storeService.typeImagesArray.subscribe(e=>{1===e.length&&(this.type.image={name:e[0].name,original:e[0].original,size:e[0].size},this.updateType())}),this._fileUploadSubscription=this._fileUploadService.pushImageTypeToStorage(e,0,this.type.id).subscribe(e=>{this.percentage=Math.round(e||0)},e=>{})}}return e.\u0275fac=function(t){return new(t||e)(u.Y36(n.gz),u.Y36(p.uw),u.Y36(d.J),u.Y36(g.c),u.Y36(m.M),u.Y36(n.F0),u.Y36(h.d))},e.\u0275cmp=u.Xpm({type:e,selectors:[["app-edit-type"]],decls:4,vars:2,consts:[[1,"site__centered"],["class","nice-form",3,"formGroup","ngSubmit",4,"ngIf","ngIfElse"],["notFoundType",""],[1,"nice-form",3,"formGroup","ngSubmit"],[1,"site__title"],[1,"nice-form__row"],["appearance","outline"],["type","text","formControlName","title","matInput","",3,"focusout"],[4,"ngIf"],[1,"nice-form__row","nice-form__row_double"],["type","button","mat-raised-button","",1,"btn","btn_small",3,"click"],["hidden","","type","file","name","photo","accept","image/png, image/jpeg",3,"change"],["fileInput",""],["appearance","outline",1,"nice-form__hidden"],["hidden","","type","text","formControlName","fileName","matInput",""],[1,"nice-form__notice"],["class","nice-form__row",4,"ngIf"],[1,"nice-form__title"],["class","nice-list",4,"ngIf"],["type","button",1,"site__link","site__link_2",3,"click"],["type","submit",1,"btn","nice-form__submit",3,"disabled"],["type","button",1,"site__link","site__link_3",3,"click"],["class","nice-form__error",4,"ngIf"],[1,"nice-form__error"],[3,"isTypePreview","selectedFiles","removeFile"],[1,"nice-list"],["class","nice-list__item",4,"ngFor","ngForOf"],[1,"nice-list__item"],[1,"site-icon","site-icon_delete",3,"click"],[1,"site__link",3,"routerLink"]],template:function(e,t){if(1&e&&(u.TgZ(0,"div",0),u.YNc(1,w,38,5,"form",1),u.YNc(2,F,8,2,"ng-template",null,2,u.W1O),u.qZA()),2&e){const e=u.MAs(3);u.xp6(1),u.Q6J("ngIf",t.isType)("ngIfElse",e)}},directives:[s.O5,r._Y,r.JL,r.sg,f.KE,f.hX,r.Fj,_.Nt,r.JJ,r.u,b.lW,v.p,s.sg,n.yS],styles:[""]}),e})()}];let N=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[n.Bz.forChild(C)],n.Bz]}),e})();var J=i(3841),U=i(2051),O=i(440);let k=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[s.ez,N,r.u5,b.ot,f.lN,_.c,J.LD,U.D,r.UX,O.a]]}),e})()},5031:(e,t,i)=>{"use strict";i.d(t,{M:()=>c});var s=i(529),n=i(9996),r=i(5366),o=i(2693),a=i(5540);let c=(()=>{class e{constructor(e,t){this._http=e,this._angularFireDatabase=t}create(e){return this._angularFireDatabase.list(`/products/${e.type}`).push(e)}getAll(){return this._http.get(`${s.N.firebaseConfig.databaseURL}/products.json`).pipe((0,n.U)(e=>{let t={};const i=Object.values(e);for(let s=0;s<i.length;s++)t=Object.assign(t,i[s]);return Object.keys(t).map(e=>Object.assign(Object.assign({},t[e]),{id:e}))}))}getByTypeAndID(e,t){return this._http.get(`${s.N.firebaseConfig.databaseURL}/products/${e}/${t}.json`).pipe((0,n.U)(e=>null===e?{}:Object.assign(Object.assign({},e),{id:t})))}getProductsByType(e){return this._http.get(`${s.N.firebaseConfig.databaseURL}/products/${e}.json`).pipe((0,n.U)(e=>e?Object.keys(e).map(t=>Object.assign(Object.assign({},e[t]),{id:t})):[]))}remove(e){return this._angularFireDatabase.object(`/products/${e.type}/${e.id}`).remove()}update(e){return this._angularFireDatabase.list(`/products/${e.type}`).set(e.id,e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(o.eN),r.LFG(a.KQ))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);