(self.webpackChunkbuildmarket_angular=self.webpackChunkbuildmarket_angular||[]).push([[481],{4481:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CreateTypeModule:()=>N});var r=i(1116),s=i(1334),n=i(1462),o=i(6446),c=i(2925),l=i(5366),a=i(2935),u=i(5763),p=i(8207),m=i(6455),d=i(3070),f=i(9550),g=i(4369),h=i(6761);function _(e,t){1&e&&(l.TgZ(0,"div",20),l._uU(1,"\u0412\u0432\u0435\u0434\u0456\u0442\u044c \u043d\u0430\u0437\u0432\u0443 \u0442\u0438\u043f\u0443"),l.qZA())}function v(e,t){1&e&&(l.TgZ(0,"div",20),l._uU(1,"\u0422\u0430\u043a\u0430 \u043d\u0430\u0437\u0432\u0430 \u0432\u0436\u0435 \u0456\u0441\u043d\u0443\u0454"),l.qZA())}function Z(e,t){if(1&e&&(l.TgZ(0,"div"),l.YNc(1,_,2,0,"div",19),l.YNc(2,v,2,0,"div",19),l.qZA()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("ngIf",e.form.get("title").errors.required),l.xp6(1),l.Q6J("ngIf",e.form.get("title").errors.busyTitle)}}function b(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",3),l.TgZ(1,"app-selected-files",21),l.NdJ("removeFile",function(t){return l.CHM(e),l.oxw().removeSelectedFile(t)}),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(1),l.Q6J("isTypePreview",!0)("selectedFiles",e.selectedFiles)}}function y(e,t){if(1&e&&(l.TgZ(0,"span"),l._uU(1),l.qZA()),2&e){const e=l.oxw().$implicit;l.xp6(1),l.hij("(",e.unit,")")}}function T(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"li",24),l._uU(1),l.YNc(2,y,2,1,"span",6),l.TgZ(3,"span",25),l.NdJ("click",function(){const t=l.CHM(e).index;return l.oxw(2).removeParameter(t)}),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(1),l.hij(" ",e.title," "),l.xp6(1),l.Q6J("ngIf",e.unit)}}function A(e,t){if(1&e&&(l.TgZ(0,"ul",22),l.YNc(1,T,4,2,"li",23),l.qZA()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("ngForOf",e.paramsArray)}}const w=[{path:"",component:(()=>{class e{constructor(e,t,i,r,s){this._dialog=e,this._fileUploadService=t,this._productTypeService=i,this._router=r,this._storeService=s,this.paramsArray=[],this.percentage=0,this.selectedFiles=[],this.submitted=!1}initForm(){this.form=new n.cw({fileName:new n.NI("",n.kI.required),title:new n.NI(null,n.kI.required)})}isTypeTitleOnServer(e,t){return!!t.find(t=>t.title.trim().toLowerCase()===e.trim().toLowerCase())}ngOnDestroy(){var e;null===(e=this._imagesSubscription)||void 0===e||e.unsubscribe()}ngOnInit(){this.initForm(),this._storeService.typeImagesArray.next([])}onFileSelected(e){let t=e.target.files;this.selectFile(t),this.form.controls.fileName.setValue(t[0]?t[0].name:"")}removeParameter(e){this.paramsArray.splice(e,1)}removeSelectedFile(e){this.selectedFiles=[],this.form.controls.fileName.setValue("")}selectFile(e){Array.from(e).forEach(e=>{let t,i=new FileReader;i.onloadend=r=>{t=i.result,this.selectedFiles=[{file:e,image:t,isOnStorage:!1,name:e.name,size:e.size}]},i.readAsDataURL(e)})}showNewParamPopup(){const e=this._dialog.open(o.q,{width:"400px",data:{paramsArray:this.paramsArray}}).afterClosed().subscribe(t=>{t&&this.paramsArray.push(t),e.unsubscribe()})}submit(){if(this.form.invalid)return;let e="";const t=this.form.get("title").value;this._storeService.showPreloader.next(!0);const i=this._productTypeService.getTypes().subscribe(r=>{if(this.isTypeTitleOnServer(t,r))return console.error("This type already exists on the server."),this.form.controls.title.setErrors({busyTitle:!0}),this._storeService.showPreloader.next(!1),void i.unsubscribe();if(localStorage.getItem("user")){const t=JSON.parse(localStorage.getItem("user"));t.email&&(e=t.email)}const s={date:(new Date).toString(),history:[{email:e,date:(new Date).toString()}],parameters:[...this.paramsArray],title:this.form.get("title").value};this._productTypeService.create(s).then(e=>{if(!e.key)return console.error("No key"),void this._storeService.showPreloader.next(!1);if(!this.selectedFiles.length)return console.error("No image selected"),void this._storeService.showPreloader.next(!1);const t=new c.p(this.selectedFiles[0].file);this._imagesSubscription=this._storeService.typeImagesArray.subscribe(t=>{if(1===t.length){const i=Object.assign(Object.assign({},s),{id:e.key,image:{name:t[0].name,original:t[0].original,size:t[0].size}});this.updateType(i)}}),this._fileUploadService.pushImageTypeToStorage(t,0,e.key).subscribe(e=>{this.percentage=Math.round(e||0)},e=>{})}),i.unsubscribe()})}titleFocusOut(e){const t=this._productTypeService.getTypes().subscribe(i=>{this.isTypeTitleOnServer(e.target.value,i)&&this.form.controls.title.setErrors({busyTitle:!0}),t.unsubscribe()})}updateType(e){this._productTypeService.update(e).then(()=>{var e;null===(e=this._imagesSubscription)||void 0===e||e.unsubscribe(),this.form.reset(),this.submitted=!1,this._storeService.showPreloader.next(!1),this._storeService.typeImagesArray.next([]),this._router.navigate(["/admin","types"])},e=>{})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(a.uw),l.Y36(u.J),l.Y36(p.c),l.Y36(s.F0),l.Y36(m.d))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-create-type"]],decls:34,vars:5,consts:[[1,"site__centered"],[1,"nice-form",3,"formGroup","ngSubmit"],[1,"site__title"],[1,"nice-form__row"],["appearance","outline"],["type","text","formControlName","title","matInput","",3,"focusout"],[4,"ngIf"],[1,"nice-form__row","nice-form__row_double"],["type","button","mat-raised-button","",1,"btn","btn_small",3,"click"],["hidden","","type","file","name","photo","accept","image/png, image/jpeg",3,"change"],["fileInput",""],["appearance","outline",1,"nice-form__hidden"],["hidden","","type","text","formControlName","fileName","matInput",""],[1,"nice-form__notice"],["class","nice-form__row",4,"ngIf"],[1,"nice-form__title"],["class","nice-list",4,"ngIf"],["type","button",1,"site__link","site__link_2",3,"click"],["type","submit",1,"btn","nice-form__submit",3,"disabled"],["class","nice-form__error",4,"ngIf"],[1,"nice-form__error"],[3,"isTypePreview","selectedFiles","removeFile"],[1,"nice-list"],["class","nice-list__item",4,"ngFor","ngForOf"],[1,"nice-list__item"],[1,"site-icon","site-icon_delete",3,"click"]],template:function(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",0),l.TgZ(1,"form",1),l.NdJ("ngSubmit",function(){return t.submit()}),l.TgZ(2,"h1",2),l._uU(3,"\u041d\u043e\u0432\u0438\u0439 \u0442\u0438\u043f \u0442\u043e\u0432\u0430\u0440\u0456\u0432"),l.qZA(),l.TgZ(4,"div",3),l.TgZ(5,"mat-form-field",4),l.TgZ(6,"mat-label"),l._uU(7,"\u041d\u0430\u0437\u0432\u0430 \u0442\u0438\u043f\u0443"),l.qZA(),l.TgZ(8,"input",5),l.NdJ("focusout",function(e){return t.titleFocusOut(e)}),l.qZA(),l.qZA(),l.YNc(9,Z,3,2,"div",6),l.qZA(),l.TgZ(10,"div",7),l.TgZ(11,"div"),l.TgZ(12,"button",8),l.NdJ("click",function(){return l.CHM(e),l.MAs(15).click()}),l._uU(13,"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0442\u0435 \u0444\u043e\u0442\u043e \u0442\u0438\u043f\u0443"),l.qZA(),l.TgZ(14,"input",9,10),l.NdJ("change",function(e){return t.onFileSelected(e)}),l.qZA(),l.TgZ(16,"mat-form-field",11),l._UZ(17,"input",12),l.qZA(),l.qZA(),l.TgZ(18,"div",13),l._uU(19," \u0414\u043b\u044f \u043a\u0440\u0430\u0449\u043e\u0433\u043e \u0432\u0456\u0434\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f \u043f\u043e\u0432\u0438\u043d\u043d\u0435 \u043c\u0430\u0442\u0438 \u0440\u043e\u0437\u043c\u0456\u0440\u0438 600 \u043f\u0456\u043a\u0441\u0435\u043b\u0456\u0432 \u043f\u043e \u0433\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u0456 \u0442\u0430 400 \u043f\u0456\u043a\u0441\u0435\u043b\u0456\u0432 \u043f\u043e \u0432\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u0456. "),l.qZA(),l.qZA(),l.YNc(20,b,2,2,"div",14),l.TgZ(21,"div",3),l.TgZ(22,"h2",15),l._uU(23,"\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438 \u0442\u043e\u0432\u0430\u0440\u0443"),l.qZA(),l.TgZ(24,"p"),l._uU(25,"\u0414\u043b\u044f \u043a\u043e\u0436\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0443 \u0442\u043e\u0432\u0430\u0440\u0456\u0432 \u0431\u0443\u0434\u0443\u0442\u044c \u0441\u0432\u043e\u0457 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438 (\u0432\u0430\u0433\u0430, \u043c\u0430\u0440\u043a\u0430, \u0431\u0440\u0435\u043d\u0434 \u0442\u043e\u0449\u043e), \u043a\u043e\u0442\u0440\u0456 \u0431\u0443\u0434\u0443\u0442\u044c \u0437\u0430\u043f\u043e\u0432\u043d\u044e\u0432\u0430\u0442\u0438\u0441\u044c \u043f\u0440\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u0456 \u0442\u043e\u0432\u0430\u0440\u0443. \u0417\u0430 \u0446\u0438\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 \u043c\u043e\u0436\u043d\u0430 \u0431\u0443\u0434\u0435 \u0432\u0456\u0434\u0444\u0456\u043b\u044c\u0442\u0440\u0443\u0432\u0430\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u043e\u0432\u0430\u0440\u0456\u0432 \u0443 \u043a\u0430\u0442\u0430\u043b\u043e\u0437\u0456."),l.qZA(),l.YNc(26,A,2,1,"ul",16),l.TgZ(27,"p"),l.TgZ(28,"button",17),l.NdJ("click",function(){return t.showNewParamPopup()}),l.TgZ(29,"span"),l._uU(30,"\u0414\u043e\u0434\u0430\u0442\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(31,"div",3),l.TgZ(32,"button",18),l._uU(33,"\u0414\u043e\u0434\u0430\u0442\u0438 \u0442\u0438\u043f"),l.qZA(),l.qZA(),l.qZA(),l.qZA()}2&e&&(l.xp6(1),l.Q6J("formGroup",t.form),l.xp6(8),l.Q6J("ngIf",t.form.get("title").touched&&t.form.get("title").invalid),l.xp6(11),l.Q6J("ngIf",t.selectedFiles.length>0),l.xp6(6),l.Q6J("ngIf",t.paramsArray.length>0),l.xp6(6),l.Q6J("disabled",t.form.invalid||t.submitted))},directives:[n._Y,n.JL,n.sg,d.KE,d.hX,n.Fj,f.Nt,n.JJ,n.u,r.O5,g.lW,h.p,r.sg],styles:[""]}),e})()}];let S=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({imports:[[s.Bz.forChild(w)],s.Bz]}),e})();var q=i(3841),x=i(440),F=i(2051);let N=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({imports:[[r.ez,S,n.u5,g.ot,d.lN,f.c,q.LD,F.D,n.UX,x.a]]}),e})()}}]);